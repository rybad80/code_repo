version: 2

models:
  - name: department_care_network
    tests:
    - dbt_chop_utils.is_primary_key:
        column_names: [dept_key]  
    columns:
      - name: department_name
        tests:
          - not_null
      - name: department_id
        tests:
          - not_null     
      - name: specialty_name
        tests:
          - not_null 
      - name: first_completed_encounter_date
        tests:
          - not_null:
              tags: ['failing']
          - dbt_chop_utils.date_in_past
      - name: last_completed_encounter_date
        tests:
          - not_null:
              tags: ['failing']
          - dbt_chop_utils.date_in_past:
              error_if: ">1"
              warn_if: ">0"
      - name: scc_ind
        tests:
          - dbt_chop_utils.is_indicator      
          - not_null 
      - name: professional_billing_ind
        tests:
          - dbt_chop_utils.is_indicator      
          - not_null 
      - name: encounter_current_fy_ind
        tests:
          - dbt_chop_utils.is_indicator      
          - not_null  
      - name: primary_care_ind
        tests:
          - dbt_chop_utils.is_indicator      
          - not_null:
              tags: ['failing']
      - name: specialty_care_ind
        tests:
          - dbt_chop_utils.is_indicator      
          - not_null:
              tags: ['failing']
      - name: record_status_active_ind
        tests:
          - dbt_chop_utils.is_indicator      
          - not_null
  - name: department_cost_center_xref
    tests:
      - dbt_chop_utils.is_primary_key:
          column_names: [dept_key, align_dt_key]
    columns:
      - name: dept_key
  - name: dim_department
    tests:
      - dbt_chop_utils.is_primary_key:
          column_names: [dept_key]
  - name: department_history
    tests:
      - dbt_chop_utils.is_primary_key:
          column_names: [dept_key, valid_from_date]
